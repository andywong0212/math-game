<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å…¨ä¸€AIæ•¸å­¸å°åŠ©æ‰‹ ğŸ¤–</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      margin: 0; padding: 0; text-align: center;
      overflow-x: hidden;
      background: url("classroom.jpg") no-repeat center center fixed;
      background-size: cover;
    }
    #startScreen {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255,255,255,0.9);
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      z-index: 100;
    }
    #startBtn, #restartBtn, #musicBtn, #teacherBtn, #teacherStartBtn, #exitBtn {
      font-size: 1.1em; padding: 10px 20px;
      border: none; border-radius: 10px;
      background: linear-gradient(to bottom, #48cae4, #0096c7);
      color: white; cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      margin: 8px;
    }
    #teacherPanel {
      display:none; background:white; padding:20px; border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.3); margin-top:20px;
      text-align:left;
    }
    header {
      background: rgba(0, 119, 182, 0.9); color: white;
      padding: 12px; display: flex; justify-content: space-around;
      flex-wrap: wrap; z-index: 1;
    }
    #gameCard {
      max-width: 550px; margin: 20px auto; padding: 20px;
      background: rgba(255,255,255,0.9);
      border-radius: 15px; box-shadow: 0 8px 15px rgba(0,0,0,0.3);
      display: none; position: relative; z-index: 1;
    }
    #robotImg { width: 120px; margin: 10px auto; }
    #question { font-size: 1.5em; margin: 15px 0; color: #023e8a; }
    #picQuestion { font-size: 2em; margin: 15px 0; }
    #feedback { font-size: 1.2em; min-height: 2em; color: #0096c7; }
    #answerInput {
      font-size: 1.2em; padding: 10px; border: 2px solid #0096c7;
      border-radius: 8px; width: 120px; text-align: center;
    }
    #submitBtn {
      font-size: 1.2em; padding: 10px 20px; border: none;
      border-radius: 10px; background: linear-gradient(to bottom, #48cae4, #0096c7);
      color: white; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    #progress { margin-top:10px; font-size:1.1em; color:#333; }
    #levelUp { font-size: 2em; color: #ffb703; font-weight: bold; display: none; }
    .starFly { position: absolute; font-size: 2em; animation: fly 1s ease-out forwards; }
    @keyframes fly { from{ transform:translateY(0); opacity:1; }
                     to{ transform:translateY(-150px); opacity:0; } }
    canvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; }
    #options button {
      font-size: 1.2em; margin: 5px; padding: 10px 20px;
      border-radius: 10px; border: none;
      background: linear-gradient(to bottom, #48cae4, #0096c7);
      color: white; cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- é–‹å§‹é  -->
  <div id="startScreen">
    <h1>å…¨ä¸€AIæ•¸å­¸å°åŠ©æ‰‹ ğŸ¤–</h1>
    <button id="startBtn">é–‹å§‹éŠæˆ²</button>
    <button id="teacherBtn">è€å¸«æ¨¡å¼</button>
    <button id="musicBtn">ğŸµ éŸ³æ¨‚: é–‹</button>

    <!-- è€å¸«æ¨¡å¼è¨­å®š -->
    <div id="teacherPanel">
      <h3>é¸æ“‡è¦ç·´ç¿’çš„é¡Œå‹ï¼š</h3>
      <label><input type="checkbox" value="0"> æ•¸å­—é¡Œ</label><br>
      <label><input type="checkbox" value="1"> æ°´æœæ•¸æ•¸é¡Œ</label><br>
      <label><input type="checkbox" value="2"> é•·çŸ­é¡Œ</label><br>
      <label><input type="checkbox" value="3"> å¹³é¢åœ–å½¢é¡Œ</label><br>
      <label><input type="checkbox" value="4"> æ–¹å‘é¡Œ</label><br>
      <label><input type="checkbox" value="5"> ç«‹é«”åœ–å½¢é¡Œ</label><br><br>
      é¡Œæ•¸ï¼š<input type="number" id="teacherTotal" value="20" min="5" max="50"> é¡Œ
      <br><br>
      <button id="teacherStartBtn">é–‹å§‹ç·´ç¿’</button>
    </div>
  </div>

  <!-- ç‹€æ…‹åˆ— -->
  <header style="display:none;" id="statusBar">
    <div id="level">Level: 1</div>
    <div id="stars">â­ x 0</div>
    <div id="timer">å‰©é¤˜æ™‚é–“: 60 ç§’</div>
  </header>

  <!-- éŠæˆ²å€ -->
  <div id="gameCard">
    <img id="robotImg" src="https://twemoji.maxcdn.com/v/14.0.2/72x72/1f916.png">
    <p id="question">æº–å‚™å¥½äº†å—ï¼Ÿ</p>
    <div id="picQuestion"></div>
    <div id="feedback">è¼¸å…¥æ­£ç¢ºç­”æ¡ˆï¼</div>
    <input type="text" id="answerInput" placeholder="ç­”æ¡ˆ">
    <button id="submitBtn">æäº¤ç­”æ¡ˆ</button>
    <div id="options" style="margin:15px;"></div>
    <div id="progress">ç¬¬ 0 / 0 é¡Œ</div>
    <button id="exitBtn">é€€å‡º</button>
    <div id="levelUp">LEVEL UP!</div>
  </div>

  <canvas id="fireworks"></canvas>

  <!-- éŸ³æ•ˆ -->
  <audio id="bgMusic" src="bg-music.mp3" loop></audio>
  <audio id="correctSound" src="correct.mp3"></audio>
  <audio id="wrongSound" src="wrong.mp3"></audio>

<script>
const questionEl=document.getElementById("question");
const picQuestionEl=document.getElementById("picQuestion");
const feedbackEl=document.getElementById("feedback");
const answerInput=document.getElementById("answerInput");
const submitBtn=document.getElementById("submitBtn");
const starsEl=document.getElementById("stars");
const levelEl=document.getElementById("level");
const timerEl=document.getElementById("timer");
const progressEl=document.getElementById("progress");
const levelUpEl=document.getElementById("levelUp");
const gameCard=document.getElementById("gameCard");
const startScreen=document.getElementById("startScreen");
const startBtn=document.getElementById("startBtn");
const teacherBtn=document.getElementById("teacherBtn");
const teacherPanel=document.getElementById("teacherPanel");
const teacherStartBtn=document.getElementById("teacherStartBtn");
const statusBar=document.getElementById("statusBar");
const musicBtn=document.getElementById("musicBtn");
const exitBtn=document.getElementById("exitBtn");
const bgMusic=document.getElementById("bgMusic");
const correctSound=document.getElementById("correctSound");
const wrongSound=document.getElementById("wrongSound");

let correctAnswer=0, starCount=0, level=1, timeLeft=60, timer;
let lastType=-1; 
let musicOn=true;
let teacherMode=false;
let teacherTypes=[];
let totalQuestions=20;
let currentQuestion=0;

function startTimer(){ clearInterval(timer); timeLeft=60;
  timer=setInterval(()=>{ timeLeft--; timerEl.textContent=`å‰©é¤˜æ™‚é–“: ${timeLeft} ç§’`;
    if(timeLeft<=0){ clearInterval(timer); endGame(); }},1000); }

function generateQuestion(){
  if(currentQuestion>=totalQuestions){ endGame(); return; }
  currentQuestion++;
  progressEl.textContent=`ç¬¬ ${currentQuestion} / ${totalQuestions} é¡Œ`;

  let questionType;
  if(teacherMode && teacherTypes.length>0){
    do {
      questionType = parseInt(teacherTypes[Math.floor(Math.random()*teacherTypes.length)]);
    } while (questionType===lastType && teacherTypes.length>1);
  } else {
    do {
      questionType = Math.floor(Math.random() * 6);
    } while (questionType===lastType);
  }
  lastType=questionType;

  answerInput.style.display="inline-block";
  submitBtn.style.display="inline-block";
  document.getElementById("options").innerHTML="";

  let a=Math.floor(Math.random()*(level*10))+1;
  let b=Math.floor(Math.random()*(level*10))+1;
  let isAdd=Math.random()>0.5;
  const fruits=["ğŸ","ğŸŒ","ğŸ“","ğŸ‡","ğŸŠ"];
  let fruit=fruits[Math.floor(Math.random()*fruits.length)];

  if(questionType===0){
    picQuestionEl.innerHTML="";
    if(isAdd){ correctAnswer=a+b; questionEl.textContent=`${a} + ${b} = ?`; }
    else{ if(a<b)[a,b]=[b,a]; correctAnswer=a-b; questionEl.textContent=`${a} - ${b} = ?`; }
  }
  else if(questionType===1){
    let n=Math.floor(Math.random()*(level*10))+1;
    correctAnswer=n; questionEl.textContent="æœ‰å¹¾å€‹ï¼Ÿ";
    picQuestionEl.innerHTML=fruit.repeat(n);
  }
  else if(questionType===2){
    // é•·çŸ­é¡Œï¼šéš¨æ©Ÿå•é•·æˆ–çŸ­
    let emojis=["ğŸš‹","ğŸªµ","ğŸ«","ğŸ§µ","ğŸ“"];
    let symbol=emojis[Math.floor(Math.random()*emojis.length)];
    let len1=Math.floor(Math.random()*4)+3;
    let len2=Math.floor(Math.random()*4)+3;
    while(len1===len2){ len2=Math.floor(Math.random()*4)+3; }
    let askLong=Math.random()>0.5;
    questionEl.textContent=askLong?"å“ªå€‹æ¯”è¼ƒé•·ï¼Ÿ":"å“ªå€‹æ¯”è¼ƒçŸ­ï¼Ÿ";
    picQuestionEl.innerHTML=`1ï¸âƒ£ ${symbol.repeat(len1)}<br><br>2ï¸âƒ£ ${symbol.repeat(len2)}`;
    if(askLong){ correctAnswer=len1>len2?1:2; } else { correctAnswer=len1<len2?1:2; }
    showOptions([{text:"1ï¸âƒ£",value:1},{text:"2ï¸âƒ£",value:2}]);
  }
  else if(questionType===3){
    let shapes=[
      {img:"circle.png",answer:1,name:"åœ“å½¢"},
      {img:"triangle.png",answer:2,name:"ä¸‰è§’å½¢"},
      {img:"square.png",answer:3,name:"æ­£æ–¹å½¢"},
      {img:"rectangle.png",answer:4,name:"é•·æ–¹å½¢"}
    ];
    let chosen=shapes[Math.floor(Math.random()*shapes.length)];
    questionEl.textContent="é€™æ˜¯ä»€éº¼åœ–å½¢ï¼Ÿ";
    picQuestionEl.innerHTML=`<img src="${chosen.img}" style="width:120px;height:120px;">`;
    correctAnswer=chosen.answer;
    showOptions([
      {text:"åœ“å½¢",value:1},{text:"ä¸‰è§’å½¢",value:2},
      {text:"æ­£æ–¹å½¢",value:3},{text:"é•·æ–¹å½¢",value:4}
    ]);
  }
  else if(questionType===4){
    let objects=["ğŸ","ğŸŒ","ğŸ“","ğŸŠ","ğŸ‡"];
    let obj1=objects[Math.floor(Math.random()*objects.length)];
    let obj2=objects[Math.floor(Math.random()*objects.length)];
    while(obj1===obj2){ obj2=objects[Math.floor(Math.random()*objects.length)]; }
    let dirs=[{answer:"ä¸Š"},{answer:"ä¸‹"},{answer:"å·¦"},{answer:"å³"}];
    let chosen=dirs[Math.floor(Math.random()*dirs.length)];
    questionEl.textContent=`${obj1} åœ¨ ${obj2} çš„å“ªä¸€é‚Šï¼Ÿ`;
    let layout="";
    if(chosen.answer==="ä¸Š"){ layout=`${obj1}<br>${obj2}`; }
    else if(chosen.answer==="ä¸‹"){ layout=`${obj2}<br>${obj1}`; }
    else if(chosen.answer==="å·¦"){ layout=`${obj1} ${obj2}`; }
    else if(chosen.answer==="å³"){ layout=`${obj2} ${obj1}`; }
    picQuestionEl.innerHTML=`<div style="font-size:2em; line-height:1.5em;">${layout}</div>`;
    correctAnswer=chosen.answer;
    showOptions([
      {text:"ä¸Š",value:"ä¸Š"},{text:"ä¸‹",value:"ä¸‹"},
      {text:"å·¦",value:"å·¦"},{text:"å³",value:"å³"}
    ]);
  }
  else if(questionType===5){
    let solids=[
      {img:"prism.png",answer:1,name:"è§’æŸ±"},
      {img:"cylinder.png",answer:2,name:"åœ“æŸ±"},
      {img:"pyramid.png",answer:3,name:"è§’éŒ"},
      {img:"cone.png",answer:4,name:"åœ“éŒ"},
      {img:"sphere.png",answer:5,name:"çƒ"}
    ];
    let chosen=solids[Math.floor(Math.random()*solids.length)];
    questionEl.textContent="é€™æ˜¯ä»€éº¼ç«‹é«”åœ–å½¢ï¼Ÿ";
    picQuestionEl.innerHTML=`<img src="${chosen.img}" style="width:120px;height:120px;">`;
    correctAnswer=chosen.answer;
    showOptions([
      {text:"è§’æŸ±",value:1},{text:"åœ“æŸ±",value:2},
      {text:"è§’éŒ",value:3},{text:"åœ“éŒ",value:4},
      {text:"çƒ",value:5}
    ]);
  }
  feedbackEl.textContent="è«‹ä½œç­”ï¼";
}

function showOptions(optionList){
  const optionsDiv=document.getElementById("options");
  optionsDiv.innerHTML="";
  answerInput.style.display="none";
  submitBtn.style.display="none";
  optionList.forEach(opt=>{
    let btn=document.createElement("button");
    btn.textContent=opt.text;
    btn.onclick=()=>checkOption(opt.value);
    optionsDiv.appendChild(btn);
  });
}

function checkOption(value){
  if(value===correctAnswer){
    feedbackEl.textContent="ğŸ‰ ç­”å°äº†ï¼";
    starCount++; updateUI(); showStar(); correctSound.play();
    generateQuestion();
  } else { feedbackEl.textContent="âŒ å†è©¦ä¸€æ¬¡ï¼"; wrongSound.play(); }
}

function checkAnswer(){
  let userInput=answerInput.value.trim();
  if(!userInput){ feedbackEl.textContent="âš ï¸ è«‹è¼¸å…¥ç­”æ¡ˆï¼"; return; }
  let userAns=isNaN(userInput)?userInput:userInput*1;
  if(userAns===correctAnswer){
    feedbackEl.textContent="ğŸ‰ ç­”å°äº†ï¼";
    starCount++; updateUI(); showStar(); correctSound.play();
    answerInput.value=""; generateQuestion();
  } else { feedbackEl.textContent="âŒ å†è©¦ä¸€æ¬¡ï¼"; wrongSound.play(); }
}

function updateUI(){ starsEl.textContent=`â­ x ${starCount}`; levelEl.textContent=`Level: ${level}`; }
function showStar(){ const s=document.createElement("div"); s.textContent="â­"; s.className="starFly";
  s.style.left="50%"; s.style.top="60%"; gameCard.appendChild(s); setTimeout(()=>s.remove(),1000); }

function endGame(){ questionEl.textContent="ğŸ“š å®Œæˆï¼"; picQuestionEl.innerHTML="";
  feedbackEl.innerHTML=`ä½ ç­”å®Œ ${totalQuestions} é¡Œï¼Œå¾—åˆ° ${starCount} é¡†æ˜Ÿï¼<br><button id="restartBtn">é‡æ–°é–‹å§‹</button>`;
  answerInput.disabled=true; submitBtn.disabled=true;
  document.getElementById("restartBtn").addEventListener("click",restartGame); }

function restartGame(){ returnToStart(); }

function returnToStart(){
  clearInterval(timer);
  starCount=0; level=1; lastType=-1; currentQuestion=0;
  progressEl.textContent=`ç¬¬ 0 / 0 é¡Œ`;
  startScreen.style.display="flex";
  statusBar.style.display="none";
  gameCard.style.display="none";
  feedbackEl.textContent="è¼¸å…¥æ­£ç¢ºç­”æ¡ˆï¼";
  answerInput.disabled=false; submitBtn.disabled=false;
}

exitBtn.addEventListener("click",returnToStart);

startBtn.addEventListener("click",()=>{ 
  teacherMode=false; totalQuestions=20; currentQuestion=0;
  progressEl.textContent=`ç¬¬ 0 / ${totalQuestions} é¡Œ`;
  startScreen.style.display="none"; statusBar.style.display="flex"; gameCard.style.display="block"; 
  generateQuestion(); startTimer(); if(musicOn)bgMusic.play();
});

teacherBtn.addEventListener("click",()=>{ teacherPanel.style.display="block"; });

teacherStartBtn.addEventListener("click",()=>{
  teacherTypes=[...teacherPanel.querySelectorAll("input:checked")].map(cb=>cb.value);
  if(teacherTypes.length===0){ alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹é¡Œå‹ï¼"); return; }
  totalQuestions=parseInt(document.getElementById("teacherTotal").value)||20;
  currentQuestion=0;
  progressEl.textContent=`ç¬¬ 0 / ${totalQuestions} é¡Œ`;
  teacherMode=true;
  startScreen.style.display="none"; statusBar.style.display="flex"; gameCard.style.display="block";
  generateQuestion(); startTimer(); if(musicOn)bgMusic.play();
});

musicBtn.addEventListener("click",()=>{ if(musicOn){ bgMusic.pause(); musicBtn.textContent="ğŸµ éŸ³æ¨‚: é—œ"; }
  else{ bgMusic.play(); musicBtn.textContent="ğŸµ éŸ³æ¨‚: é–‹"; } musicOn=!musicOn; });

submitBtn.addEventListener("click",checkAnswer);
answerInput.addEventListener("keypress",(e)=>{ if(e.key==="Enter")checkAnswer(); });

</script>
</body>
</html>
